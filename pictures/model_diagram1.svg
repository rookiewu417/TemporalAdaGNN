<svg width="900" height="450" viewBox="0 0 900 450" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Arrowhead Marker -->
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#555555" />
    </marker>

    <!-- Gradients -->
    <linearGradient id="gradTime" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E3F2FD;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#90CAF9;stop-opacity:1" />
    </linearGradient>

    <linearGradient id="gradSpace" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FFF3E0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FFB74D;stop-opacity:1" />
    </linearGradient>

    <linearGradient id="gradFusion" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#F3E5F5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#CE93D8;stop-opacity:1" />
    </linearGradient>

    <!-- Heatmap Pattern for Matrix -->
    <pattern id="gridPattern" width="10" height="10" patternUnits="userSpaceOnUse">
      <rect width="10" height="10" fill="#FFE0B2" stroke="#FF9800" stroke-width="0.5"/>
      <rect width="6" height="6" x="2" y="2" fill="#EF6C00" opacity="0.6"/>
    </pattern>
  </defs>

  <!-- Background -->
  <rect width="100%" height="100%" fill="white"/>

  <!-- ==================== 1. Input Tensor (Left) ==================== -->
  <g transform="translate(40, 140)">
    <text x="30" y="-15" font-family="Arial" font-size="14" font-weight="bold" fill="#333" text-anchor="middle">Input Tensor</text>
    <text x="30" y="80" font-family="Arial" font-size="11" fill="#666" text-anchor="middle">(N Stocks × T Days)</text>
    <!-- Stacked Sheets -->
    <path d="M10 10 L50 10 L60 20 L60 60 L20 60 L10 50 Z" fill="#BBDEFB" stroke="#1976D2" stroke-width="1"/>
    <path d="M5 5 L45 5 L55 15 L55 55 L15 55 L5 45 Z" fill="#90CAF9" stroke="#1976D2" stroke-width="1"/>
    <rect x="0" y="0" width="40" height="40" fill="#E3F2FD" stroke="#1565C0" stroke-width="1.5"/>
    <!-- Grid lines -->
    <line x1="10" y1="0" x2="10" y2="40" stroke="#1565C0" stroke-width="0.5"/>
    <line x1="20" y1="0" x2="20" y2="40" stroke="#1565C0" stroke-width="0.5"/>
    <line x1="30" y1="0" x2="30" y2="40" stroke="#1565C0" stroke-width="0.5"/>
    <line x1="0" y1="10" x2="40" y2="10" stroke="#1565C0" stroke-width="0.5"/>
    <line x1="0" y1="20" x2="40" y2="20" stroke="#1565C0" stroke-width="0.5"/>
    <line x1="0" y1="30" x2="40" y2="30" stroke="#1565C0" stroke-width="0.5"/>
  </g>

  <!-- Arrow: Input -> Temporal -->
  <path d="M110 160 L140 160" stroke="#555" stroke-width="2" marker-end="url(#arrow)" fill="none"/>

  <!-- ==================== 2. Temporal Module (Top Middle) ==================== -->
  <g transform="translate(150, 100)">
    <rect x="0" y="0" width="140" height="120" rx="10" ry="10" fill="url(#gradBlue)" stroke="#1976D2" stroke-width="1.5"/>
    <text x="70" y="25" font-family="Arial" font-size="12" font-weight="bold" fill="#0D47A1" text-anchor="middle">Temporal Module</text>
    <text x="70" y="105" font-family="Arial" font-size="11" font-style="italic" fill="#0D47A1" text-anchor="middle">GRU Encoder</text>

    <!-- GRU Logic Icon -->
    <circle cx="40" cy="60" r="10" fill="white" stroke="#1565C0" stroke-width="1.5"/>
    <text x="40" y="64" font-size="10" text-anchor="middle" fill="#1565C0">σ</text>
    <circle cx="100" cy="60" r="10" fill="white" stroke="#1565C0" stroke-width="1.5"/>
    <text x="100" y="64" font-size="10" text-anchor="middle" fill="#1565C0">tanh</text>
    <path d="M52 60 L88 60" stroke="#1565C0" stroke-width="1.5" marker-end="url(#arrow)"/>
    <path d="M40 48 L40 40 L100 40 L100 48" stroke="#1565C0" stroke-width="1.5" fill="none"/>
    <rect x="10" y="55" width="18" height="10" fill="#BBDEFB" stroke="none"/> <!-- Input hint -->
  </g>

  <!-- Arrow: Temporal -> Features -->
  <path d="M290 160 L320 160" stroke="#555" stroke-width="2" marker-end="url(#arrow)" fill="none"/>

  <!-- ==================== 3. Node Features H_self ==================== -->
  <g transform="translate(320, 130)">
    <rect x="0" y="0" width="80" height="60" rx="5" ry="5" fill="white" stroke="#42A5F5" stroke-width="1.5" stroke-dasharray="4,2"/>
    <text x="40" y="-10" font-family="Arial" font-size="12" font-weight="bold" fill="#333" text-anchor="middle">Features</text>
    <text x="40" y="75" font-family="Arial" font-size="11" font-style="italic" fill="#666" text-anchor="middle">(H_self)</text>
    <!-- Feature vector visualization -->
    <rect x="10" y="15" width="8" height="30" fill="#2196F3"/>
    <rect x="22" y="15" width="8" height="30" fill="#64B5F6"/>
    <rect x="34" y="15" width="8" height="30" fill="#90CAF9"/>
    <rect x="46" y="15" width="8" height="30" fill="#BBDEFB"/>
    <rect x="58" y="15" width="8" height="30" fill="#E3F2FD"/>
  </g>

  <!-- ==================== 4. Adaptive Graph Learner (Bottom Middle - INDEPENDENT) ==================== -->
  <g transform="translate(260, 270)">
    <rect x="0" y="0" width="180" height="120" rx="10" ry="10" fill="url(#gradOrange)" stroke="#F57C00" stroke-width="1.5"/>
    <text x="90" y="25" font-family="Arial" font-size="12" font-weight="bold" fill="#E65100" text-anchor="middle">Adaptive Graph</text>
    <text x="90" y="110" font-family="Arial" font-size="11" font-style="italic" fill="#E65100" text-anchor="middle">Learned Params E1, E2</text>

    <!-- Matrix Mult Visualization -->
    <g transform="translate(25, 40)">
      <rect x="0" y="10" width="10" height="40" fill="#FFE0B2" stroke="#EF6C00"/>
      <text x="5" y="65" font-size="10" text-anchor="middle" fill="#EF6C00">E1</text>
      <text x="20" y="35" font-size="14" fill="#E65100">×</text>
      <rect x="35" y="25" width="40" height="10" fill="#FFE0B2" stroke="#EF6C00"/>
      <text x="55" y="18" font-size="10" text-anchor="middle" fill="#EF6C00">E2ᵀ</text>
      <text x="85" y="35" font-size="14" fill="#E65100">=</text>
      <rect x="100" y="15" width="40" height="40" fill="url(#gridPattern)" stroke="#EF6C00"/>
    </g>
  </g>

  <!-- Arrow: H_self -> GNN -->
  <path d="M400 160 L450 160" stroke="#555" stroke-width="2" marker-end="url(#arrow)" fill="none"/>

  <!-- Arrow: Graph -> GNN (Curved) -->
  <path d="M440 330 L460 330 Q510 330 510 280 L510 240" stroke="#F57C00" stroke-width="2" marker-end="url(#arrow)" fill="none"/>

  <!-- ==================== 5. GNN Fusion (Center Right) ==================== -->
  <g transform="translate(450, 100)">
    <rect x="0" y="0" width="140" height="140" rx="10" ry="10" fill="url(#gradPurple)" stroke="#7B1FA2" stroke-width="1.5"/>
    <text x="70" y="25" font-family="Arial" font-size="13" font-weight="bold" fill="#4A148C" text-anchor="middle">GNN Fusion</text>
    <text x="70" y="130" font-family="Arial" font-size="10" font-style="italic" fill="#4A148C" text-anchor="middle">Aggregate(Self, Neighbors)</text>

    <!-- Node Aggregation Icon -->
    <g transform="translate(70, 75)">
        <circle cx="0" cy="0" r="14" fill="#E1BEE7" stroke="#4A148C" stroke-width="2"/>
        <text x="0" y="4" font-size="10" text-anchor="middle" font-weight="bold" fill="#4A148C">i</text>

        <!-- Neighbors -->
        <circle cx="-35" cy="-20" r="8" fill="white" stroke="#7B1FA2"/>
        <circle cx="35" cy="-20" r="8" fill="white" stroke="#7B1FA2"/>
        <circle cx="0" cy="35" r="8" fill="white" stroke="#7B1FA2"/>

        <!-- Edges -->
        <line x1="-28" y1="-15" x2="-12" y2="-5" stroke="#7B1FA2" stroke-width="1.5" marker-end="url(#arrow)"/>
        <line x1="28" y1="-15" x2="12" y2="-5" stroke="#7B1FA2" stroke-width="1.5" marker-end="url(#arrow)"/>
        <line x1="0" y1="26" x2="0" y2="16" stroke="#7B1FA2" stroke-width="1.5" marker-end="url(#arrow)"/>
    </g>
  </g>

  <!-- Arrow: GNN -> Predictor -->
  <path d="M590 170 L630 170" stroke="#555" stroke-width="2" marker-end="url(#arrow)" fill="none"/>

  <!-- ==================== 6. Prediction Head (Right) ==================== -->
  <g transform="translate(630, 120)">
    <rect x="0" y="0" width="110" height="100" rx="8" ry="8" fill="#F5F5F5" stroke="#607D8B" stroke-width="1.5"/>
    <text x="55" y="20" font-family="Arial" font-size="12" font-weight="bold" fill="#37474F" text-anchor="middle">Predictor</text>

    <!-- Concat & MLP Logic -->
    <g transform="translate(20, 40)">
      <!-- Concat -->
      <rect x="0" y="0" width="10" height="20" fill="#90CAF9" stroke="none"/>
      <rect x="10" y="0" width="10" height="20" fill="#CE93D8" stroke="none"/>
      <rect x="0" y="0" width="20" height="20" fill="none" stroke="#455A64" stroke-width="1"/>
      <text x="10" y="-5" font-size="9" fill="#455A64" text-anchor="middle">Cat</text>

      <!-- MLP -->
      <line x1="20" y1="10" x2="40" y2="10" stroke="#455A64" stroke-width="1.5"/>
      <rect x="40" y="5" width="10" height="10" fill="#CFD8DC" stroke="#455A64"/> <!-- Hidden Layer -->
      <line x1="50" y1="10" x2="70" y2="10" stroke="#455A64" stroke-width="1.5" marker-end="url(#arrow)"/>
    </g>
  </g>

  <!-- Arrow: Predictor -> List -->
  <path d="M740 170 L770 170" stroke="#555" stroke-width="2" marker-end="url(#arrow)" fill="none"/>

  <!-- ==================== 7. Output Ranking ==================== -->
  <g transform="translate(770, 110)">
    <text x="50" y="-10" font-family="Arial" font-size="12" font-weight="bold" fill="#2E7D32" text-anchor="middle">Stock Ranking</text>
    <line x1="10" y1="10" x2="10" y2="120" stroke="#333" stroke-width="1"/>
    <!-- Bars -->
    <rect x="12" y="15" width="70" height="10" fill="#2E7D32" />
    <rect x="12" y="30" width="60" height="10" fill="#43A047" />
    <rect x="12" y="45" width="50" height="10" fill="#66BB6A" />
    <rect x="12" y="60" width="40" height="10" fill="#81C784" />
    <rect x="12" y="75" width="30" height="10" fill="#A5D6A7" />
    <rect x="12" y="90" width="20" height="10" fill="#C8E6C9" />
    <rect x="12" y="105" width="10" height="10" fill="#E8F5E9" />

    <text x="8" y="24" font-size="9" text-anchor="end" fill="#555">High</text>
    <text x="8" y="114" font-size="9" text-anchor="end" fill="#555">Low</text>
  </g>
</svg>