<svg width="1000" height="750" viewBox="0 0 1000 750" xmlns="http://www.w3.org/2000/svg">
  <!-- Definitions for gradients and markers -->
  <defs>
    <linearGradient id="gradData" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E3F2FD;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#BBDEFB;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="gradModel" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#F3E5F5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#E1BEE7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="gradGraph" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E8F5E9;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C8E6C9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="gradOutput" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FFF3E0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FFE0B2;stop-opacity:1" />
    </linearGradient>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#555" />
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#aaa"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="100%" height="100%" fill="#ffffff" />

  <!-- TITLE -->
  <text x="500" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">Temporal AdaGNN: End-to-End Quant Architecture</text>

  <!-- PHASE 1: DATA PREPARATION -->
  <g transform="translate(50, 80)">
    <text x="0" y="-10" font-family="Arial" font-size="16" font-weight="bold" fill="#1565C0">Phase 1: Data Preparation</text>

    <!-- Global Tensor Stack -->
    <rect x="20" y="20" width="100" height="120" fill="url(#gradData)" stroke="#1976D2" stroke-width="2" filter="url(#shadow)"/>
    <rect x="30" y="10" width="100" height="120" fill="url(#gradData)" stroke="#1976D2" stroke-width="2" style="opacity:0.5"/>
    <rect x="40" y="0" width="100" height="120" fill="url(#gradData)" stroke="#1976D2" stroke-width="2" style="opacity:0.3"/>

    <text x="70" y="80" font-family="Arial" font-size="12" text-anchor="middle">Global Tensor</text>
    <text x="70" y="100" font-family="Arial" font-size="10" text-anchor="middle">[N, Total_T, F]</text>
    <text x="70" y="120" font-family="Arial" font-size="10" text-anchor="middle" font-style="italic">Pinned Memory</text>

    <!-- Rolling Window Arrow -->
    <path d="M150 70 L200 70" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="175" y="60" font-family="Arial" font-size="10" text-anchor="middle">Rolling Window</text>
    <text x="175" y="90" font-family="Arial" font-size="10" text-anchor="middle">[T-20 : T-1]</text>

    <!-- Batch Slice -->
    <rect x="210" y="20" width="80" height="100" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" stroke-dasharray="5,5"/>
    <text x="250" y="60" font-family="Arial" font-size="12" text-anchor="middle">Batch Input</text>
    <text x="250" y="80" font-family="Arial" font-size="10" text-anchor="middle">X: [N, 20, F]</text>
  </g>

  <!-- PHASE 2: MODEL BRAIN -->
  <g transform="translate(50, 250)">
    <text x="0" y="-10" font-family="Arial" font-size="16" font-weight="bold" fill="#6A1B9A">Phase 2: The Brain (Temporal AdaGNN)</text>

    <!-- Container Box -->
    <rect x="0" y="10" width="600" height="350" fill="none" stroke="#6A1B9A" stroke-width="2" rx="10" />

    <!-- Left Brain: Temporal (GRU) -->
    <g transform="translate(30, 40)">
      <rect x="0" y="0" width="140" height="100" fill="#E1BEE7" stroke="#8E24AA" stroke-width="2" filter="url(#shadow)"/>
      <text x="70" y="30" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Left Brain</text>
      <text x="70" y="50" font-family="Arial" font-size="12" text-anchor="middle">Temporal (GRU)</text>
      <text x="70" y="80" font-family="Arial" font-size="10" text-anchor="middle" fill="#4A148C">Extract Trend</text>
    </g>

    <!-- Arrow from Input to GRU -->
    <path d="M 100 -50 L 100 40" stroke="#555" stroke-width="2" marker-end="url(#arrow)" fill="none"/>

    <!-- H_self Output -->
    <text x="100" y="170" font-family="Courier New" font-size="14" font-weight="bold" text-anchor="middle" fill="#8E24AA">H_self</text>
    <path d="M 100 140 L 100 190" stroke="#8E24AA" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- Right Brain: Spatial (Graph Learner) -->
    <g transform="translate(30, 200)">
      <rect x="0" y="0" width="140" height="120" fill="#C8E6C9" stroke="#2E7D32" stroke-width="2" filter="url(#shadow)"/>
      <text x="70" y="25" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Right Brain</text>
      <text x="70" y="45" font-family="Arial" font-size="12" text-anchor="middle">Adaptive Graph</text>

      <!-- Equation -->
      <text x="70" y="70" font-family="Times New Roman" font-size="12" text-anchor="middle" font-style="italic">E1 Â· E2_T</text>
      <text x="70" y="90" font-family="Arial" font-size="10" text-anchor="middle" fill="#1B5E20">Learnable Embeddings</text>
    </g>

    <!-- Adjacency Matrix Output -->
    <text x="210" y="260" font-family="Courier New" font-size="14" font-weight="bold" text-anchor="middle" fill="#2E7D32">Adj Matrix (A)</text>
    <path d="M 170 260 L 230 260" stroke="#2E7D32" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- CORTEX: GNN FUSION -->
    <g transform="translate(260, 100)">
      <rect x="0" y="0" width="160" height="180" fill="#FFF9C4" stroke="#FBC02D" stroke-width="3" filter="url(#shadow)"/>
      <text x="80" y="30" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Cortex (GNN)</text>
      <text x="80" y="50" font-family="Arial" font-size="12" text-anchor="middle">Message Passing</text>

      <!-- Logic visual -->
      <circle cx="80" cy="100" r="30" fill="none" stroke="#F57F17" stroke-width="2"/>
      <circle cx="80" cy="100" r="5" fill="#F57F17"/>
      <circle cx="60" cy="90" r="5" fill="#aaa"/>
      <circle cx="100" cy="90" r="5" fill="#aaa"/>
      <circle cx="80" cy="125" r="5" fill="#aaa"/>
      <path d="M60 90 L80 100 M100 90 L80 100 M80 125 L80 100" stroke="#aaa" stroke-width="1"/>

      <text x="80" y="150" font-family="Arial" font-size="10" text-anchor="middle" fill="#E65100">"Neighbors affect Me"</text>
    </g>

    <!-- Flows into GNN -->
    <path d="M 140 210 L 260 210 L 260 210" stroke="#8E24AA" stroke-width="2" fill="none" marker-end="url(#arrow)">
       <!-- Connection from H_self to GNN -->
       <animate attributeName="d" from="100 190 L 100 200 L 260 200" to="100 190 L 100 200 L 260 200" begin="0s" dur="1s" fill="freeze" />
    </path>
    <path d="M 100 190 L 100 210 L 260 210" stroke="#8E24AA" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    <path d="M 230 260 L 260 260 L 260 260" stroke="#2E7D32" stroke-width="2" fill="none"/> <!-- A connects to GNN logic internally -->
    <line x1="260" y1="260" x2="300" y2="260" stroke="#2E7D32" stroke-width="2"/>
    <line x1="300" y1="260" x2="300" y2="180" stroke="#2E7D32" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- Output of GNN -->
    <text x="400" y="190" font-family="Courier New" font-size="14" font-weight="bold" text-anchor="start" fill="#F57F17">H_graph</text>

    <!-- PREDICTION HEAD -->
    <g transform="translate(480, 100)">
        <!-- Concatenation -->
        <circle cx="30" cy="90" r="20" fill="#fff" stroke="#333" stroke-width="2"/>
        <text x="30" y="95" font-family="Arial" font-size="20" text-anchor="middle">+</text>
        <text x="30" y="130" font-family="Arial" font-size="10" text-anchor="middle">Concat</text>

        <!-- MLP -->
        <rect x="70" y="40" width="40" height="100" fill="#B0BEC5" stroke="#455A64" stroke-width="2"/>
        <text x="90" y="95" font-family="Arial" font-size="12" text-anchor="middle" transform="rotate(-90, 90, 95)">MLP</text>
    </g>

    <!-- Connect components to head -->
    <path d="M 420 190 L 460 190 L 510 210" stroke="#F57F17" stroke-width="2" fill="none" /> <!-- H_graph to concat visual adjustment needed -->
    <path d="M 420 190 L 450 190 L 490 190" stroke="#F57F17" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

    <!-- Bypass connection (Residual) H_self to Concat -->
    <path d="M 100 190 L 100 340 L 510 340 L 510 210" stroke="#8E24AA" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrow)"/>
    <text x="300" y="335" font-family="Arial" font-size="10" fill="#8E24AA">Skip Connection (H_self)</text>

  </g>

  <!-- PHASE 3 & 4: OUTPUT & LOSS -->
  <g transform="translate(700, 250)">
    <text x="0" y="-10" font-family="Arial" font-size="16" font-weight="bold" fill="#D84315">Phase 3: Optimization</text>

    <!-- Score Output -->
    <rect x="0" y="140" width="80" height="60" fill="url(#gradOutput)" stroke="#E64A19" stroke-width="2" filter="url(#shadow)"/>
    <text x="40" y="170" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Scores</text>
    <text x="40" y="190" font-family="Courier New" font-size="12" text-anchor="middle">Y_pred</text>

    <!-- Connect Model to Score -->
    <path d="M -90 190 L 0 170" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- Ground Truth -->
    <rect x="120" y="140" width="80" height="60" fill="#eee" stroke="#333" stroke-width="2" stroke-dasharray="2,2"/>
    <text x="160" y="170" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Reality</text>
    <text x="160" y="190" font-family="Courier New" font-size="12" text-anchor="middle">Y_true</text>

    <!-- Loss Function Block -->
    <g transform="translate(40, 260)">
        <rect x="0" y="0" width="120" height="80" fill="#FFCDD2" stroke="#C62828" stroke-width="2"/>
        <text x="60" y="25" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="#B71C1C">Hybrid Loss</text>
        <line x1="10" y1="40" x2="110" y2="40" stroke="#C62828" stroke-width="1"/>
        <text x="60" y="55" font-family="Arial" font-size="10" text-anchor="middle">1. MSE (Value)</text>
        <text x="60" y="70" font-family="Arial" font-size="10" text-anchor="middle">2. IC (Rank)</text>
    </g>

    <!-- Arrows to Loss -->
    <path d="M 40 200 L 80 260" stroke="#E64A19" stroke-width="2" marker-end="url(#arrow)"/>
    <path d="M 160 200 L 120 260" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- Backprop Arrow -->
    <path d="M 100 340 L 100 360 L -300 360 L -300 340" stroke="#C62828" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" fill="none"/>
    <text x="-100" y="375" font-family="Arial" font-size="12" fill="#C62828" font-style="italic">Backpropagation (Update Parameters)</text>

  </g>

  <!-- PHASE 4: EVALUATION METRICS -->
  <g transform="translate(50, 650)">
    <line x1="0" y1="0" x2="900" y2="0" stroke="#ccc" stroke-width="1"/>
    <text x="0" y="30" font-family="Arial" font-size="16" font-weight="bold" fill="#00695C">Phase 4: Evaluation</text>

    <g transform="translate(200, 10)">
        <rect x="0" y="0" width="100" height="50" rx="5" fill="#E0F2F1" stroke="#00695C"/>
        <text x="50" y="20" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">Rank IC</text>
        <text x="50" y="40" font-family="Arial" font-size="10" text-anchor="middle">Correlation</text>
    </g>
    <g transform="translate(320, 10)">
        <rect x="0" y="0" width="100" height="50" rx="5" fill="#E0F2F1" stroke="#00695C"/>
        <text x="50" y="20" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">Sharpe Ratio</text>
        <text x="50" y="40" font-family="Arial" font-size="10" text-anchor="middle">Risk-Adjusted</text>
    </g>
    <g transform="translate(440, 10)">
        <rect x="0" y="0" width="120" height="50" rx="5" fill="#E0F2F1" stroke="#00695C"/>
        <text x="60" y="20" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">Long/Short</text>
        <text x="60" y="40" font-family="Arial" font-size="10" text-anchor="middle">Top 20% vs Bottom</text>
    </g>
  </g>

</svg>